<!DOCTYPE html>
<html>
<head>
  <title>Movie Details</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="movieDetails"></div>

<h2>Add Review</h2>

<form action="/add_review" method="POST">
  <input type="hidden" name="movieId" id="movieId">
  <input type="text" name="username" placeholder="Your Name" required><br>
  <input type="number" name="rating" min="1" max="5" placeholder="Rating (1-5)" required><br>
  <textarea name="comment" placeholder="Write review..." required></textarea><br>
  <button type="submit">Submit Review</button>
</form>

<h2>Reviews</h2>
<div id="reviews"></div>

<script>
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

document.getElementById("movieId").value = id;

fetch("/movie/" + id)
  .then(res => res.json())
  .then(data => {
    const movie = data.movie;

    document.getElementById("movieDetails").innerHTML = `
      <h1>${movie.title}</h1>
      <img src="${movie.poster}" width="300">
      <p>${movie.genre} • ${movie.year}</p>
      <p>${movie.description}</p>
      <h3>⭐ Average Rating: ${data.avgRating}</h3>
    `;

    const reviewContainer = document.getElementById("reviews");

    data.reviews.forEach(review => {
      reviewContainer.innerHTML += `
        <div class="review">
          <strong>${review.username}</strong> ⭐ ${review.rating}
          <p>${review.comment}</p>
        </div>
      `;
    });
  });
</script>

</body>
</html>
